<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookmark Manager</title>

    <style>
        /* Global Styles */
        body {
            background-image: url('path/to/default-background.jpg');
            background-attachment: fixed;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #000;
            text-align: center;
        }

        /* Container for title and settings button */
        #title-container {
            position: relative;
            height: 100px;
            display: flex;
            align-items: center;
            background: linear-gradient(to bottom, #030361, transparent 100%);
        }

        /* Title styling */
        #title-container h1 {
            color: #90e0ef;
            font-size: 48px;
            background-color: transparent;
            text-shadow: 2px 2px 4px #000000;
            flex-grow: 1;
        }

        #startServerButton {
            position: absolute;
            top: 5px;
            right: 40px;
            font-size: 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #90e0ef;
        }

        /* Settings button */
        #settings-button {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #90e0ef;
        }

        /* Settings popup */
        #settings-popup.show {
            color: #00000000;
            top: 0px;
            width: 100%;
            height: 100%;
            background: rgba(210, 22, 22, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            overflow-y: scroll;
        }

        #settings-popup {
            position: fixed;
            display: none;
        }

        #settings-container {
            display: show;
            font-size: 22px;
            background-color: #00000096;
            color: #ffffff;
            padding: 20px;
            box-shadow: 0 0 10px #000000;
            border-radius: 20px;
        }

        #settings-form {
            font-size: 10px;
            padding: 10px;
            flex-direction: column;
            text-decoration: none;
            background-color: #52525200;
        }

        #settings-form label {
            color: #c6c6c6;
            display: flex;
        }

        #settings-form input {
            border-radius: 5px;
            background-color: #747474;
            padding: 0px;
            margin: 5px;
            text-decoration: none;
        }

        #settings-form button {
            background-color: #00bfff;
            color: #000;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
            padding: 8px;
            text-decoration: none;
        }

        .collapse-button,
        .edit-button {
            font-size: 20px;
            color: #111111;
            background-color: transparent;
            border: none;
            font-weight: bold;
        }

        .collapse-button:hover,
        .edit-button:hover {
            color: #636163;
        }

        /* Toolbar Styles */
        #toolbar {
            color: #00000000;
        }

        .toolbar-button,
        #form-toggle,
        #search-sort-toggle {
            background-color: #0096c7;
            color: #111111;
            border: none;
            padding: 6px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            box-shadow: 0px 0px 2px #111111
        }

        /* Form Styles */
        #bookmark-form-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        #bookmark-form {
            background-color: #111;
            border-radius: 10px;
            padding: 20px;
            z-index: 1000;
            align-items: center;

        }

        /* Input Styles */
        #bookmark-form input {
            padding: 8px;
            border: 1px solid #333;
            border-radius: 5px;
            background-color: #111;
            color: #ddd;
            display: block;
            margin-bottom: 10px;
            /* Add margin-bottom to create vertical spacing between fields */
        }

        #bookmark-form button {
            background-color: #0096c7;
            color: #111111;
            border: none;
            padding: 6px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;

        }

        /* Search/Sort Styles */
        .toggleable-section {
            max-height: 0;
            overflow: hidden;
        }

        .toggleable-section.show {
            max-height: 500px;
            transition: max-height 0.3s ease-in;

        }

        .search-sort-order,
        #search-sort {
            color: #111111;
            display: inline-block;
            justify-content: center;
            margin-bottom: 10px;
            margin-top: 10px;
            text-shadow: 0px 0px 10px #979dac;
            font-size: 20px;
            font-weight: bold;
        }

        /* Category Styles */
        .category-container {
            margin-bottom: 20px;
            background-color: rgba(31, 199, 214, 0.427);
            margin-left: 20px;
            margin-right: 20px;
            border: 2px groove #333;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0px 0px 40px #000;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.5em;
            margin-bottom: 10px;
            margin-top: px;
            height: 25px;
            color: #001D3D;
            cursor: pointer;
            font-weight: bold;
            text-shadow: 0px 0px 20px #fff;

        }

        .category-header span {
            /* background: radial-gradient(ellipse, #778da9, transparent 80%);*/
            width: calc(90% + 0px);
            border-bottom: 2px outset #111111;
        }

        .category-bookmarks {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 35px;
        }

        /* Bookmark Item Styles */
        .bookmark-item {
            position: relative;
            width: 200px;
            height: 80px;
            margin: 10px;
            padding: 15px;
            border: 1px solid #555;
            border-radius: 21px;
            background-color: #000;
            transition: box-shadow 0.2s;
            box-shadow: 0 8px 12px rgba(0, 0, 0, .2);
            cursor: pointer;

        }

        .bookmark-item:hover {
            box-shadow: 0px 0px 10px #00bfff;
            transition: box-shadow .2s ease-in-out;
        }

        .bookmark-item a {
            text-decoration: none;
            font-size: 20px;
            color: #ddd;
            font-weight: bold;
            margin: 10px;
            transition: color 0.5s;
        }

        .bookmark-item a:hover {
            color: #0de61f;
        }

        .bookmark-item a.favorite {
            color: #e57373;
        }

        .bookmark-item span {
            font-size: 15px;

        }

        .bookmark-item p {
            color: #ddd;
            margin-bottom: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .favorite-icon {
            position: absolute;
            top: 5px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0) !important;
            color: #d4ff00;
            border: none;
            cursor: pointer;
            font-size: 6px;
            padding: 0;
        }

        /* Updated style for the delete button */
        .delete-button,
        .bookmark-item button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 9px;
            padding: 2;
        }

        .delete-button,
        .bookmark-item button:hover {
            background-color: transparent;
            color: #636163;
        }

        /* Updated styles for folder bar */
        #folder-bar {
            position: fixed;
            background-color: #003566;
            padding: 10px;
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
            cursor: move;
            width: 30px;
            z-index: 999;
            transition: width 0.3s ease-in-out;
        }

        #folder-bar button {
            background-color: transparent;
            color: #ffffff;
            border: none;
            cursor: pointer;
            font-size: 26px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            margin: 0;
        }

        #folder-bar button:hover {
            color: #244e46;
        }

        #ribbon {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 0;
            background-color: #003566;
            color: #fff;
            z-index: 999;
            transition: width 0.3s ease-in-out;
            overflow: hidden;
            border-right: 8px solid #003566;
        }

        #ribbon-content {
            position: relative;
            width: 100%;
            overflow: hidden;
            justify-content: center;
            align-items: center;
            white-space: nowrap;
            font-size: 25px;
            margin-top: 5px;
        }

        .ribbon-line {
            width: 80%;
            height: 2px;
            background-color: #5c677d;
            margin: 10%;
            box-shadow: 0px 0px 10px #000;
        }


        .ribbon-title {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 20px;
            font-size: 22px;
            text-shadow: 0px 0px 30px #000;

        }

        .ribbon-category {
            cursor: pointer;
            color: #fff;
            padding: 15px;
            text-shadow: 2px 2px 4px #003566;
            background-color: #003566;
        }

        .ribbon-category:hover {
            background-color: #5c677d;
        }

        #userstyles {
            usercolorinputs;
        }
    </style>

<body>

    <!-- Updated Folder Bar -->
    <div id="folder-bar" class="collapsed">
        <button id="folder-bar-btn" onclick="toggleRibbon()">☰</button>
    </div>

    <!-- Ribbon element -->
    <div id="ribbon">
        <div id="ribbon-content">Bookmark<br>Folders</div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="collapsed">
        <div id="title-container">
            <h1>Bookmark Manager</h1>

            <!-- ⚙ ➤ -->
            <button id="startServerButton" onclick="startServer()">🌐</button>
            <button id="settings-button" onclick="colorSettings()">🎨</button>
        </div>

        <!-- Updated Settings popup -->
        <div id="settings-popup" class="collapsed">
            <div id="settings-overlay"></div>
            <div id="settings-container"> Settings
                <form id="settings-form">
                    <label for="titleColor">Title Color:</label>
                    <input type="color" id="titleColor" name="titleColor" value="#90e0ef"><br>

                    <label for="categoryHeaderColor">Category Header Color:</label>
                    <input type="color" id="categoryHeaderColor" name="categoryHeaderColor" value="#001D3D"><br>

                    <label for="ribbonColor">Ribbon Color:</label>
                    <input type="color" id="ribbonColor" name="ribbonColor" value="#003566"><br>

                    <label for="titleContainerBackgroundColor">Title Container Background Color:</label>
                    <input type="color" id="titleContainerBackgroundColor" name="titleContainerBackgroundColor"
                        value="#030361"><br>

                    <label for="toolbarButtonColor">Toolbar Button Color:</label>
                    <input type="color" id="toolbarButtonColor" name="toolbarButtonColor" value="#0096c7"><br>

                    <label for="bodyBackgroundColor">Body Background Color:</label>
                    <input type="color" id="bodyBackgroundColor" name="bodyBackgroundColor" value="#000"><br>

                    <label for="bookmarkItemBackgroundColor">Bookmark Item Background Color:</label>
                    <input type="color" id="bookmarkItemBackgroundColor" name="bookmarkItemBackgroundColor"
                        value="#000"><br>

                    <label for="bookmarkItemOpacity">Bookmark Item Opacity:</label>
                    <input type="range" id="bookmarkItemOpacity" name="bookmarkItemOpacity" value="1.0" min="0" max="1"
                        step="0.1"><br>

                    <label for="categoryContainerBackgroundColor">Category Container Background Color:</label>
                    <input type="color" id="categoryContainerBackgroundColor" name="categoryContainerBackgroundColor"
                        value="#1fc7d6"><br>

                    <label for="categoryContainerOpacity">Category Box Opacity:</label>
                    <input type="range" id="categoryContainerOpacity" name="categoryContainerOpacity" value="0.42"
                        min="0" max="1" step="0.1"><br>

                    <button type="button" onclick="closeColorSettings()">Close</button>
                </form>
            </div>
        </div>

        <div id="toolbar">
            <input type="file" id="backgroundImageInput" style="display: none;" accept="image/*">
            <button class="toolbar-button" onclick="uploadBackgroundImage()">Upload Background Image</button>
            <button class="toolbar-button" id="form-toggle" onclick="toggleBookmarkForm()">Create Bookmark</button>
            <button class="toolbar-button" id="search-sort-toggle" onclick="toggleSearchsort('search-sort')">Toggle
                Search/Sort</button>
            <button class="toolbar-button" onclick="deleteAllBookmarks()">Delete All Bookmarks</button>
            <button class="toolbar-button" onclick="exportHTML()">Export HTML</button>

            <input type="file" id="importFile" style="display: none" accept=".html,.json" onchange="importBookmarks()">
            <label for="importFile" class="toolbar-button">Import Bookmarks</label>
        </div>

        <div id="bookmark-form-container" style="display: none;">
            <form id="bookmark-form">
                <input type="text" id="siteName" placeholder="Site Name" required>
                <input type="url" id="siteURL" placeholder="Site URL" required>
                <input type="text" id="category" placeholder="Category">
                <button type="button" onclick="addOrUpdateBookmark()">Add/Update Bookmark</button>
                <button type="button" onclick="toggleBookmarkForm()">Close</button>
            </form>
        </div>

        <div id="search-sort" class="toggleable-section">
            <div class="search-sort-order">
                <label for="search">Search:</label>
                <input type="text" id="search" oninput="filterBookmarks()" placeholder="Enter keyword">
            </div>
            <div class="search-sort-order">
                <label for="sort">Sort by:</label>
                <select id="sort" onchange="sortBookmarks()">
                    <option value="name">Name</option>
                </select>

                <label for="order">Order:</label>
                <select id="order" onchange="sortBookmarks()">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                </select>
            </div>
        </div>

        <div id="bookmark-list"></div>

        <p id="feedback"></p>
    </div>

    <script>

        // Sample bookmarks data
        let bookmarks = [{ "name": "Google", "url": "https://www.google.com", "category": "Search Engine", "favorite": false },];

        // Function to handle background image upload
        function uploadBackgroundImage() {
            const backgroundImageInput = document.getElementById('backgroundImageInput');
            backgroundImageInput.click();

            // Listen for changes in the file input
            backgroundImageInput.addEventListener('change', function () {
                const file = this.files[0];

                if (file) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        // Set the uploaded image as the background
                        document.body.style.backgroundImage = `url('${e.target.result}')`;
                        document.body.style.backgroundSize = 'cover';
                    };

                    reader.readAsDataURL(file);
                }
            });
        }

        // Function to delete all bookmarks
        function deleteAllBookmarks() {
            bookmarks = [];
            renderBookmarks();
            document.getElementById('feedback').innerText = 'All bookmarks deleted successfully!';
        }


        +   // Filters the bookmarks by the specified category and renders them.
            function filterByCategory(category) {
                const filteredBookmarks = bookmarks.filter(bookmark => bookmark.category === category);
                renderBookmarks(filteredBookmarks);
            }

        // Function to toggle the settings popup
        function colorSettings() {
            const settingsPopup = document.getElementById('settings-popup');
            settingsPopup.classList.toggle('show');

            // Live update colors and opacity as the user changes them
            const colorInputs = document.querySelectorAll('input[type="color"]');
            const categoryContainerOpacityInput = document.getElementById('categoryContainerOpacity');
            const bookmarkItemOpacityInput = document.getElementById('bookmarkItemOpacity');

            colorInputs.forEach(input => {
                input.addEventListener('input', function () {
                    updateStyles();
                });
            });

            categoryContainerOpacityInput.addEventListener('input', function () {
                updateStyles();
            });

            bookmarkItemOpacityInput.addEventListener('input', function () {
                updateStyles();
            });

            function updateStyles() {
                // Get the updated color and opacity values
                const bodyBackgroundColor = document.getElementById('bodyBackgroundColor').value;
                const titleColor = document.getElementById('titleColor').value;
                const titleContainerBackgroundColor = document.getElementById('titleContainerBackgroundColor').value;
                const ribbonColor = document.getElementById('ribbonColor').value;
                const toolbarButtonColor = document.getElementById('toolbarButtonColor').value;
                const categoryHeaderColor = document.getElementById('categoryHeaderColor').value;
                const categoryContainerBackgroundColor = document.getElementById('categoryContainerBackgroundColor').value;
                const categoryContainerOpacity = categoryContainerOpacityInput.value; // Updated line

                // Calculate the background color with opacity
                const categoryContainerBackgroundOpacity = `rgba(${hexToRgb(categoryContainerBackgroundColor)}, ${categoryContainerOpacity})`;

                const bookmarkItemOpacity = bookmarkItemOpacityInput.value;
                const bookmarkItemBackgroundColor = document.getElementById('bookmarkItemBackgroundColor').value;

                // Update styles
                const pageTitle = document.querySelector('#title-container h1');
                pageTitle.style.color = titleColor;

                document.querySelectorAll('.category-header span').forEach(span => {
                    span.style.color = categoryHeaderColor;
                });

                const titleContainer = document.getElementById('title-container');
                titleContainer.style.background = `linear-gradient(to bottom, ${titleContainerBackgroundColor}, transparent 100%)`;

                document.querySelectorAll('.toolbar-button').forEach(button => {
                    button.style.backgroundColor = toolbarButtonColor;
                });

                const ribbon = document.getElementById('ribbon');
                ribbon.style.backgroundColor = ribbonColor;
                ribbon.style.border = `5px solid ${ribbonColor}`;

                // Update folderBar color
                const folderBar = document.getElementById('folder-bar');
                folderBar.style.backgroundColor = ribbonColor;

                // Update category colors in the ribbon
                document.querySelectorAll('.ribbon-category').forEach(categoryDiv => {
                    categoryDiv.style.backgroundColor = ribbonColor;
                });

                // Update body background color
                document.body.style.backgroundColor = bodyBackgroundColor;

                // Update bookmark item background color and opacity
                const bookmarkItems = document.querySelectorAll('.bookmark-item');
                bookmarkItems.forEach(item => {
                    item.style.backgroundColor = bookmarkItemBackgroundColor;
                    item.style.opacity = bookmarkItemOpacity;
                });

                // Update category container styles with background color and opacity
                const categoryContainers = document.querySelectorAll('.category-container');
                categoryContainers.forEach(item => {
                    item.style.backgroundColor = categoryContainerBackgroundOpacity; // Updated line

                    // Update styles for edit and collapse buttons
                    const categoryHeader = item.querySelector('.category-header');
                    categoryHeader.querySelector('.collapse-button').style.color = categoryHeaderColor;
                    categoryHeader.querySelector('.edit-button').style.color = categoryHeaderColor;
                });

            }
        }

        // Helper function to convert hex color to RGB
        function hexToRgb(hex) {
            const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function (m, r, g, b) {
                return r + r + g + g + b + b;
            });
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
        }


        // Function to close the settings popup
        function closeColorSettings() {
            const settingsPopup = document.getElementById('settings-popup');
            settingsPopup.classList.remove('show');
        }

        // Function to toggle the ribbon visibility
        function toggleRibbon() {
            const ribbon = document.getElementById('ribbon');
            const folderBar = document.getElementById('folder-bar');
            const folderBarButton = document.getElementById('folder-bar-btn');

            const isRibbonCollapsed = ribbon.style.width === '0px';

            if (isRibbonCollapsed) {
                // Clear existing content in the ribbon
                ribbon.innerHTML = '';

                // Set the title of the content to "Bookmarks Folder"
                const titleDiv = document.createElement('div');
                titleDiv.classList.add('ribbon-title');
                titleDiv.innerHTML = 'Bookmarks<br>Folder';
                ribbon.appendChild(titleDiv);

                // Add a line under the content title
                const titleLineDiv = document.createElement('div');
                titleLineDiv.classList.add('ribbon-line');
                ribbon.appendChild(titleLineDiv);

                // Get unique categories from bookmarks
                const uniqueCategories = [...new Set(bookmarks.map(bookmark => bookmark.category))];

                // Create a div for each category and append it to the ribbon
                uniqueCategories.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.innerText = category || 'Uncategorized';
                    categoryDiv.classList.add('ribbon-category');
                    categoryDiv.addEventListener('click', () => filterByCategory(category));
                    ribbon.appendChild(categoryDiv);

                    // Add a horizontal line after each category (except the last one)
                    if (category !== uniqueCategories[uniqueCategories.length - 1]) {
                        const lineDiv = document.createElement('div');
                        lineDiv.classList.add('ribbon-line');
                        ribbon.appendChild(lineDiv);
                    }
                });

                // Update styles and transition
                ribbon.style.width = '150px';
                folderBar.style.width = '30px';
                folderBar.style.transition = 'width 0.3s ease-in-out, transform 0.3s ease-in-out';
                folderBar.style.transform = 'translateX(149px)';
            } else {
                ribbon.style.width = '0';
                folderBar.style.width = '30px';
                folderBar.style.transform = 'translateX(0)';
                setTimeout(() => {
                    folderBar.style.transition = 'none';  // Remove transition after the animation
                }, 300);  // Adjust the timeout to match the transition duration
            }
        }

        // Function to toggle the folder bar visibility
        function toggleFolderBar() {
            const folderBar = document.getElementById('folder-bar');
            const mainContent = document.getElementById('main-content');

            folderBar.classList.toggle('collapsed');
            mainContent.classList.toggle('collapsed');
        }

        // Make the folder bar draggable
        dragElement(document.getElementById("folder-bar"));

        function dragElement(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            if (document.getElementById(elmnt.id + "-btn")) {
                document.getElementById(elmnt.id + "-btn").onmousedown = dragMouseDown;
            } else {
                elmnt.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos2 = pos4 - e.clientY;
                pos4 = e.clientY;

                // Restrict movement within the window
                const maxX = window.innerWidth - elmnt.offsetWidth;
                const maxY = window.innerHeight - elmnt.offsetHeight;

                let newLeft = elmnt.offsetLeft - pos1;
                let newTop = elmnt.offsetTop - pos2;

                newLeft = Math.max(0, Math.min(newLeft, maxX));
                newTop = Math.max(0, Math.min(newTop, maxY));

                elmnt.style.left = newLeft + "px";
                elmnt.style.top = newTop + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Function to toggle the form visibility
        function toggleBookmarkForm() {
            const formContainer = document.getElementById('bookmark-form-container');
            formContainer.style.display = formContainer.style.display === 'none' ? 'flex' : 'none';
        }

        // Function to toggle the visibility of a section
        function toggleSearchsort(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('show');
            if (section.classList.contains('show')) {
                section.style.maxHeight = section.scrollHeight + 'px';
            } else {
                section.style.maxHeight = '0';
            }
        }
        function exportHTML() {
            // Clone the document element to avoid modifying the actual DOM
            const clonedDocument = document.documentElement.cloneNode(true);

            // Modify the HTML content to replace the sample bookmarks and include color settings
            const modifiedHTML = clonedDocument.innerHTML
                .replace(/let bookmarks = \[([\s\S]+?)\];/, `let bookmarks = ${JSON.stringify(bookmarks)};`)
                .replace('usercolorinputs;', getStyleSettings());

            // Create a Blob with the modified HTML content
            const blob = new Blob([modifiedHTML], { type: 'text/html' });

            // Create a download link and trigger the download
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bookmark_manager.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            document.getElementById('feedback').innerText = 'HTML exported successfully!';
        }

        function getStyleSettings() {
            const styleSettings =
                `body {
        background-color: ${document.getElementById('bodyBackgroundColor').value};
    }
    #ribbon {
        background-color: ${document.getElementById('ribbonColor').value};
        border: 5px solid ${document.getElementById('ribbonColor').value};
    }
    #folder-bar {
        background-color: ${document.getElementById('ribbonColor').value};
    }
    #title-container {
        background: linear-gradient(to bottom, ${document.getElementById('titleContainerBackgroundColor').value}, transparent 100%);
    }
    #toolbar button {
        background-color: ${document.getElementById('toolbarButtonColor').value};
    }
    .bookmark-item {
        background-color: ${document.getElementById('bookmarkItemBackgroundColor').value};
        opacity: ${document.getElementById('bookmarkItemOpacity').value};
    }
    .category-container {
        background-color: rgba(${hexToRgb(document.getElementById('categoryContainerBackgroundColor').value)}, ${document.getElementById('categoryContainerOpacity').value});
    }
    .category-header span {
        color: ${document.getElementById('categoryHeaderColor').value};
    }
    #settings-popup.show {
        background-color: rgba(${hexToRgb(document.getElementById('categoryContainerBackgroundColor').value)}, ${document.getElementById('categoryContainerOpacity').value});
    }
    .collapse-button,
    .edit-button,
    .delete-button,
    .favorite-icon {
        color: ${document.getElementById('categoryHeaderColor').value};
    }
</style>
    `;
            return styleSettings;
        }

        // Add the hexToRgb function to convert hex color to RGB
        function hexToRgb(hex) {
            // Remove the hash sign if present
            hex = hex.replace(/^#/, '');

            // Convert each pair of hex digits to decimal and join them with commas
            const rgb = hex.match(/.{1,2}/g).map(val => parseInt(val, 16)).join(',');

            return rgb;
        }


        // Function to import bookmarks from Firefox bookmark.htmlf
        function importBookmarks() {
            const input = document.getElementById('importFile');
            const file = input.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const importedHTML = e.target.result;
                    const parser = new DOMParser();
                    const htmlDoc = parser.parseFromString(importedHTML, 'text/html');

                    // Extract bookmarks from Firefox bookmark.html structure
                    const firefoxBookmarks = extractFirefoxBookmarks(htmlDoc);

                    // Merge the imported bookmarks with the existing ones
                    bookmarks = [...bookmarks, ...firefoxBookmarks];
                    applyUpdatedColors();

                    renderBookmarks();
                    document.getElementById('feedback').innerText = 'Bookmarks imported successfully!';
                };
                reader.readAsText(file);
            }
        }

        // Function to extract bookmarks from Firefox bookmark.html structure
        function extractFirefoxBookmarks(htmlDoc) {
            const bookmarks = [];
            // Find all bookmarks in the HTML document
            const bookmarkElements = htmlDoc.querySelectorAll('a');

            bookmarkElements.forEach(bookmarkElement => {
                const name = bookmarkElement.textContent.trim();
                const url = bookmarkElement.href;
                const categoryElement = bookmarkElement.closest('DT').parentNode.previousElementSibling;

                // Extract category from the parent element of the bookmark
                const category = categoryElement ? categoryElement.textContent.trim() : 'Uncategorized';

                bookmarks.push({ name, url, category, favorite: false });
            });

            return bookmarks;
        }

        // Function to add or update a bookmark
        async function addOrUpdateBookmark() {
            const siteName = document.getElementById('siteName').value;
            const siteURL = document.getElementById('siteURL').value;
            const category = document.getElementById('category').value;
            let description;

            try {
                description = await fetchUrlTitle(siteURL) || siteURL; // Use URL as description if title is not available
            } catch (error) {
                console.error('Error fetching URL title:', error);
                description = siteURL;
            }

            if (siteName && siteURL) {
                // Check if the bookmark already exists in the array
                const existingBookmarkIndex = bookmarks.findIndex(bookmark => bookmark.url === siteURL);

                if (existingBookmarkIndex !== -1) {
                    // Update the existing bookmark
                    bookmarks[existingBookmarkIndex] = { name: siteName, url: siteURL, category: category, description: description, favorite: false };
                } else {
                    // Add the new bookmark to the array
                    const newBookmark = { name: siteName, url: siteURL, category: category, description: description, favorite: false };
                    bookmarks.push(newBookmark);
                }

                // Merge existing bookmarks with newly added or updated bookmarks
                const mergedBookmarks = mergeBookmarks(bookmarks, getNewBookmarks());
                bookmarks = mergedBookmarks;
                applyUpdatedColors();
                renderBookmarks();
                clearForm();
                document.getElementById('feedback').innerText = 'Bookmark added/updated successfully!';
            } else {
                document.getElementById('feedback').innerText = 'Please enter both name and URL.';
            }
        }

        // Function to get newly added or updated bookmarks from the HTML
        function getNewBookmarks() {
            const newBookmarks = [];
            const bookmarkElements = document.querySelectorAll('.bookmark-item');
            bookmarkElements.forEach(bookmarkElement => {
                const url = bookmarkElement.getAttribute('data-id');
                const name = bookmarkElement.querySelector('.bookmark-link').innerText;
                const category = getCategoryFromBookmarkElement(bookmarkElement);
                const description = bookmarkElement.querySelector('p').innerText;
                const favorite = bookmarkElement.querySelector('.favorite-icon').innerHTML === '★';

                newBookmarks.push({ name, url, category, description, favorite });
            });
            return newBookmarks;
        }

        // Function to get category from a bookmark element
        function getCategoryFromBookmarkElement(bookmarkElement) {
            const categoryContainer = bookmarkElement.closest('.category-container');
            return categoryContainer.querySelector('.category-header span').innerText;
        }

        // Function to merge existing bookmarks with new bookmarks
        function mergeBookmarks(existingBookmarks, newBookmarks) {
            const mergedBookmarks = [...existingBookmarks];

            newBookmarks.forEach(newBookmark => {
                const existingIndex = mergedBookmarks.findIndex(existingBookmark => existingBookmark.url === newBookmark.url);

                if (existingIndex !== -1) {
                    // Update existing bookmark
                    mergedBookmarks[existingIndex] = newBookmark;
                } else {
                    // Add new bookmark
                    mergedBookmarks.push(newBookmark);
                }
            });

            return mergedBookmarks;
        }

        // Function to clear the form
        function clearForm() {
            document.getElementById('siteName').value = '';
            document.getElementById('siteURL').value = '';
            document.getElementById('category').value = '';
        }

        // Function to filter bookmarks based on search input
        function filterBookmarks() {
            const search = document.getElementById('search').value.toLowerCase();
            const filteredBookmarks = bookmarks.filter(bookmark =>
                bookmark.name.toLowerCase().includes(search) ||
                bookmark.url.toLowerCase().includes(search) ||
                bookmark.category.toLowerCase().includes(search)
            );
            renderBookmarks(filteredBookmarks);
        }

        // Function to sort bookmarks
        function sortBookmarks() {
            const sortBy = document.getElementById('sort').value;
            const sortOrder = document.getElementById('order').value === 'asc' ? 1 : -1;

            const sortedBookmarks = bookmarks.slice().sort((a, b) => {
                if (sortBy === 'name') {
                    return a.name.localeCompare(b.name) * sortOrder;
                }
            });

            renderBookmarks(sortedBookmarks);
        }


        // Function to toggle bookmark favorite status
        function toggleFavorite(url) {
            bookmarks.forEach(bookmark => {
                if (bookmark.url === url) {
                    bookmark.favorite = !bookmark.favorite;
                }
            });
            renderBookmarks();
        }

        // Function to render bookmarks
        function renderBookmarks(bookmarksToRender = bookmarks) {
            const bookmarkList = document.getElementById('bookmark-list');
            const existingColors = {}; // Store existing colors

            // Store existing colors before clearing the innerHTML
            bookmarkList.querySelectorAll('.category-container').forEach(categoryContainer => {
                const categoryName = categoryContainer.querySelector('.category-header span').innerText;
                const categoryColor = categoryContainer.style.backgroundColor;
                existingColors[categoryName] = categoryColor;
            });

            bookmarkList.innerHTML = '';

            // Group bookmarks by category
            const groupedBookmarks = groupBy(bookmarksToRender, 'category');

            // Iterate over grouped bookmarks and render each category
            Object.entries(groupedBookmarks).forEach(([category, categoryBookmarks]) => {
                const categoryContainer = document.createElement('div');
                categoryContainer.classList.add('category-container');

                // Create category header with collapse, category name, and edit buttons
                const categoryHeader = document.createElement('div');
                categoryHeader.classList.add('category-header');

                const collapseButton = document.createElement('button');
                collapseButton.innerText = '^';
                collapseButton.classList.add('collapse-button');
                collapseButton.onclick = () => toggleCategory(category);
                categoryHeader.appendChild(collapseButton);

                const categoryName = document.createElement('span');
                categoryName.innerText = category || 'Uncategorized';
                categoryHeader.appendChild(categoryName);

                const editButton = document.createElement('button');
                editButton.innerText = 'Edit';
                editButton.classList.add('edit-button');
                editButton.onclick = () => editCategory(category);
                categoryHeader.appendChild(editButton);

                categoryContainer.appendChild(categoryHeader);

                // Create container for bookmarks in the category
                const categoryBookmarkContainer = document.createElement('div');
                categoryBookmarkContainer.classList.add('category-bookmarks');

                // Check if the category is collapsed
                if (!collapsedCategories.includes(category)) {
                    // Render each bookmark in the category
                    categoryBookmarks.forEach(bookmark => {
                        const bookmarkItem = createBookmarkItem(bookmark);
                        categoryBookmarkContainer.appendChild(bookmarkItem);
                    });
                }

                categoryContainer.appendChild(categoryBookmarkContainer);
                bookmarkList.appendChild(categoryContainer);

                // Restore existing color if it exists
                if (existingColors[category]) {
                    categoryContainer.style.backgroundColor = existingColors[category];
                }
            });
        }

        // Creates a bookmark item element based on the provided bookmark object.
        function createBookmarkItem(bookmark) {
            const bookmarkItem = document.createElement('div');
            bookmarkItem.classList.add('bookmark-item');
            bookmarkItem.setAttribute('draggable', 'true'); // Enable draggable

            // Assign a unique identifier to each bookmark
            bookmarkItem.setAttribute('data-id', bookmark.url);





            // Star icon
            const starIcon = document.createElement('span');
            starIcon.innerHTML = bookmark.favorite ? '★' : '☆';
            starIcon.classList.add('favorite-icon');
            starIcon.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevents the click event from reaching the bookmark link
                toggleFavorite(bookmark.url);
            });
            bookmarkItem.appendChild(starIcon);

            // Bookmark link
            const bookmarkLink = document.createElement('a');
            bookmarkLink.href = bookmark.url;
            bookmarkLink.target = '_blank';
            bookmarkLink.innerText = bookmark.name.length > 20 ? `${bookmark.name.slice(0, 20)} ...` : bookmark.name;
            bookmarkLink.title = bookmark.description || bookmark.url; // Set title to bookmark description or URL
            bookmarkLink.classList.add('bookmark-link');
            bookmarkItem.appendChild(bookmarkLink);

            // Bookmark description
            const bookmarkDescription = document.createElement('p');
            bookmarkDescription.innerText = bookmark.description || '';
            bookmarkItem.appendChild(bookmarkDescription);

            // Delete button
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '&#10006;'; // Use the "x" character as the button content
            deleteButton.classList.add('delete-button');
            deleteButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevents the click event from reaching the bookmark link
                deleteBookmark(bookmark.url);
            });
            bookmarkItem.appendChild(deleteButton);

            // Add click event to the bookmark item
            bookmarkItem.addEventListener('click', () => window.open(bookmark.url, '_blank'));

            return bookmarkItem;
        }

        // Function to group an array of objects by a specified key
        function groupBy(array, key) {
            return array.reduce((result, currentValue) => {
                (result[currentValue[key]] = result[currentValue[key]] || []).push(currentValue);
                return result;
            }, {});
        }

        // Function to delete a bookmark by URL
        function deleteBookmark(url) {
            bookmarks = bookmarks.filter(bookmark => bookmark.url !== url);
            renderBookmarks();
            document.getElementById('feedback').innerText = 'Bookmark deleted successfully!';
        }

        // Array to store collapsed categories
        const collapsedCategories = [];

        // Function to toggle category
        function toggleCategory(category) {
            const index = collapsedCategories.indexOf(category);
            if (index === -1) {
                collapsedCategories.push(category);
            } else {
                collapsedCategories.splice(index, 1);
            }

            // Store the computed styles for all categories before rendering
            const categoryStylesBefore = getComputedStylesForAllCategories();

            renderBookmarks();

            // Reapply the stored styles for all categories after rendering
            applyStylesForAllCategories(categoryStylesBefore);
        }

        // Function to apply styles for all categories
        function applyStylesForAllCategories(styles) {
            // Get all category container elements
            const categoryContainers = document.querySelectorAll('.category-container');

            // Apply the stored styles for each category
            categoryContainers.forEach((categoryContainer, index) => {
                categoryContainer.style.backgroundColor = styles[index].backgroundColor;
                // Apply the updated colors here
                applyUpdatedColors(categoryContainer);
            });
        }

        function applyUpdatedColors() {
            const styleSettings = getStyleSettings(); // Get the updated styles
            const styleElement = document.getElementById('custom-styles'); // Assuming you have a <style> element with this ID

            if (styleElement) {
                // Update the styles in the existing <style> element
                styleElement.innerHTML = styleSettings;
            } else {
                // Create a new <style> element and append it to the document head
                const newStyleElement = document.createElement('style');
                newStyleElement.id = 'custom-styles';
                newStyleElement.innerHTML = styleSettings;
                document.head.appendChild(newStyleElement);
            }

            // Call the renderBookmarks function to re-render the bookmarks with the updated colors
            renderBookmarks();
        }


        // Function to get computed styles for all categories
        function getComputedStylesForAllCategories() {
            // Get all category container elements
            const categoryContainers = document.querySelectorAll('.category-container');

            // Get computed styles for each category
            const styles = Array.from(categoryContainers).map(categoryContainer => {
                const computedStyles = window.getComputedStyle(categoryContainer);
                return {
                    backgroundColor: computedStyles.backgroundColor,
                    // Add other relevant styles for debugging
                };
            });

            // Log relevant computed styles
            return styles;
        }

        // Function to edit category name
        function editCategory(category) {
            const newCategory = prompt('Edit category name:', category);
            if (newCategory !== null) {
                bookmarks.forEach(bookmark => {
                    if (bookmark.category === category) {
                        bookmark.category = newCategory;
                    }
                });
                renderBookmarks();
            }
        }
        // Add these event listeners at the end of your script

        document.addEventListener('dragstart', function (event) {
            // Set the data to be transferred during the drag
            event.dataTransfer.setData('text/plain', event.target.dataset.id);
            // Hide the dragged element
            event.target.style.opacity = '0.5';
        });

        document.addEventListener('dragover', function (event) {
            // Prevent the default behavior to enable dropping
            event.preventDefault();
        });

        document.addEventListener('drop', function (event) {
            // Get the dragged data (bookmark ID)
            const draggedBookmarkId = event.dataTransfer.getData('text/plain');
            const draggedBookmark = bookmarks.find(bookmark => bookmark.url === draggedBookmarkId);

            // Check if the drop target is a category
            const dropCategory = event.target.closest('.category-container');

            if (dropCategory) {
                const newCategory = dropCategory.querySelector('.category-header span').innerText;
                draggedBookmark.category = newCategory;
                renderBookmarks();
            }

            // Reset the opacity of the dragged element
            const draggedElement = document.querySelector(`[data-id="${draggedBookmarkId}"]`);
            if (draggedElement) {
                draggedElement.style.opacity = '1';
            }
        });

        document.addEventListener('dragend', function (event) {
            // Reset the opacity of the dragged element on drag end
            event.target.style.opacity = '1';
        });


        // Initial rendering
        renderBookmarks();
    </script>


</body>

</html>







<script>


    /*
 
    // script for local browsers storage
 
function saveDataToLocalStorage() {
    const savedData = {
        bookmarks: bookmarks,
        colors: {
            titleColor: getTitleColor(),
            categoryHeaderColor: getCategoryHeaderColor(),
            ribbonColor: getRibbonColor(),
            titleContainerBackgroundColor: getTitleContainerBackgroundColor(),
            toolbarButtonColor: getToolbarButtonColor(),
            bodyBackgroundColor: getBodyBackgroundColor(),
            bookmarkItemBackgroundColor: getBookmarkItemBackgroundColor(),
            bookmarkItemOpacity: getBookmarkItemOpacity(),
            categoryContainerBackgroundColor: getCategoryContainerBackgroundColor(),
            categoryContainerOpacity: getCategoryContainerOpacity(),
        },
        backgroundImage: getBackgroundImage(),
    };
    localStorage.setItem('savedData', JSON.stringify(savedData));
}

// Helper functions to get element values
function getTitleColor() {
    return document.getElementById('titleColor').value;
}

function getCategoryHeaderColor() {
    return document.getElementById('categoryHeaderColor').value;
}

function getRibbonColor() {
    return document.getElementById('ribbonColor').value;
}

function getTitleContainerBackgroundColor() {
    return document.getElementById('titleContainerBackgroundColor').value;
}

function getToolbarButtonColor() {
    return document.getElementById('toolbarButtonColor').value;
}

function getBodyBackgroundColor() {
    return document.getElementById('bodyBackgroundColor').value;
}

function getBookmarkItemBackgroundColor() {
    return document.getElementById('bookmarkItemBackgroundColor').value;
}

function getBookmarkItemOpacity() {
    return document.getElementById('bookmarkItemOpacity').value;
}

function getCategoryContainerBackgroundColor() {
    return document.getElementById('categoryContainerBackgroundColor').value;
}

function getCategoryContainerOpacity() {
    return document.getElementById('categoryContainerOpacity').value;
}

function getBackgroundImage() {
    return document.body.style.backgroundImage;
}
 
    // Function to load bookmarks data from localStorage
    function loadDataFromLocalStorage() {
     const savedData = localStorage.getItem('savedData');
     if (savedData) {
         const parsedData = JSON.parse(savedData);
         bookmarks = parsedData.bookmarks;
 
         // Load colors
         document.getElementById('titleColor').value = parsedData.colors.titleColor;
         document.getElementById('categoryHeaderColor').value = parsedData.colors.categoryHeaderColor;
         document.getElementById('ribbonColor').value = parsedData.colors.ribbonColor;
         document.getElementById('titleContainerBackgroundColor').value = parsedData.colors.titleContainerBackgroundColor;
         document.getElementById('toolbarButtonColor').value = parsedData.colors.toolbarButtonColor;
         document.getElementById('bodyBackgroundColor').value = parsedData.colors.bodyBackgroundColor;
         document.getElementById('bookmarkItemBackgroundColor').value = parsedData.colors.bookmarkItemBackgroundColor;
         document.getElementById('bookmarkItemOpacity').value = parsedData.colors.bookmarkItemOpacity;
         document.getElementById('categoryContainerBackgroundColor').value = parsedData.colors.categoryContainerBackgroundColor;
         document.getElementById('categoryContainerOpacity').value = parsedData.colors.categoryContainerOpacity;
 
         // Load background image
         document.body.style.backgroundImage = parsedData.backgroundImage;
     }
 }
 
 
    // Function to initialize the application
    function initializeApp() {
     loadDataFromLocalStorage();
     renderBookmarks();
 
     // Add an event listener to save data when the window is unloaded
     window.addEventListener('beforeunload', saveDataToLocalStorage);
 }
 
 // Call the initializeApp function to start the application
 initializeApp();
 
    // */
</script>